/*
	@preserve
	title: rutta
	version: 1.3.0
	author: alexander elias
*/
(function(a,b){'object'==typeof exports&&'undefined'!=typeof module?module.exports=b():'function'==typeof define&&define.amd?define('Rutta',b):a.Rutta=b()})(this,function(){'use strict';function has(a,b){return-1!==a.indexOf(b)}function clean(a){return decodeURI(a).replace(document.location.origin,'').replace(/(^\/?#?\/)/,'').replace(/(\/$)/,'')}function strip(a){return clean(a).replace(/(\?.*?$)|(#.*?$)/g,'')}function getSearch(a){return clean(a).split('?')[1]||''}function getHash(a){return clean(a).split('?')[0].split('#')[1]||''}function getPathname(a){return clean(a).split('?')[0].split('#')[0]||''}function Render(data){null!==data.title&&data.title!==void 0&&(document.title=data.title),'text'===data.type?document.querySelector(data.query).innerText=data.content:'html'===data.type?document.querySelector(data.query).innerHTML=data.content:document.querySelector(data.query).innerText='505 Router Error',window.scroll(0,0);var scripts=data.content.match(/<script>[\s\S]+<\/script>/g);scripts&&scripts.forEach(function(script){script=script.replace(/(<script>)|(<\/script>)/g,''),eval(script)})}function Request(a){this.route=a.route,this.state=a.state}function serialize(a){var b='';for(var c in a)b=0<b.length?b+'&':b,b=b+encodeURIComponent(c)+'='+encodeURIComponent(a[c]);return b}function request(a){if(!a)throw new Error('Axa: requires options');if(!a.action)throw new Error('Axa: requires options.action');if(a.method||(a.method='GET'),a.headers||(a.headers={}),a.data)if('GET'===a.method)a.action=a.action+'?'+serialize(a.data),a.data=null;else{switch(a.requestType=a.requestType?a.requestType.toLowerCase():'',a.responseType=a.responseType?a.responseType.toLowerCase():'',a.requestType){case'script':a.contentType=mime.script;break;case'json':a.contentType=mime.json;break;case'xml':a.contentType=mime.xm;break;case'html':a.contentType=mime.html;break;case'text':a.contentType=mime.text;break;default:a.contentType=mime.urlencoded;}switch(a.responseType){case'script':a.accept=mime.script;break;case'json':a.accept=mime.json;break;case'xml':a.accept=mime.xml;break;case'html':a.accept=mime.html;break;case'text':a.accept=mime.text;}a.contentType===mime.json&&(a.data=JSON.stringify(a.data)),a.contentType===mime.urlencoded&&(a.data=serialize(a.data))}var b=new XMLHttpRequest;if(b.open(a.method.toUpperCase(),a.action,!0,a.username,a.password),a.mimeType&&b.overrideMimeType(a.mimeType),a.withCredentials&&(b.withCredentials=a.withCredentials),a.accept&&(a.headers.Accept=a.accept),a.contentType&&(a.headers['Content-Type']=a.contentType),a.headers)for(var c in a.headers)b.setRequestHeader(c,a.headers[c]);b.onreadystatechange=function(){if(4===b.readyState)return 200<=b.status&&400>b.status?a.success(b):a.error(b)},b.send(a.data)}function Response(a){this.query=a.query,this.route=a.route}function Router(a){this.name=a.name,this.base=a.base,this.routes=a.routes||[],this.redirects=a.redirects||[],this.query=a.query||'[r-view="'+this.name+'"]',this.authorize=a.authorize||function(){return!0},this.isListening=!1,this.permitChangeEvent=!0,this.state=a.state||{},this.location=document.location,this.mode=null===a.mode||a.mode===void 0?MODE:a.mode,this.root=null===a.root||a.root===void 0?this.mode?'/':'#/':a.root}var Utility={has:has,clean:clean,strip:strip,getSearch:getSearch,getHash:getHash,getPathname:getPathname},Request$1=function(a){return new Request(a)},mime={script:'text/javascript, application/javascript, application/x-javascript',json:'application/json, text/javascript',xml:'application/xml, text/xml',html:'text/html',text:'text/plain',urlencoded:'application/x-www-form-urlencoded'},Axa={mime:mime,request:request,serialize:serialize};Response.prototype.send=function(a,b){var c=this;if(Render({type:'html',query:c.query,title:c.route.title,content:a}),b)return b()},Response.prototype.file=function(a,b){var c=this;Axa.request({action:a,responseType:'html',success:function(d){if(Render({type:'html',query:c.query,title:c.route.title,content:d.response}),b)return b()},error:function(d){if(Render({type:'text',query:c.query,title:c.route.title,content:d.response}),b)return b()}})},Response.prototype.redirect=function(a){window.location=a};var Response$1=function(a){return new Response(a)},PUSH=2,REPLACE=3,MODE='history'in window&&'pushState'in window.history;Router.prototype.isSameOrigin=function(a){return a&&-1<a.indexOf(document.location.origin)},Router.prototype.isSamePath=function(a,b){return Utility.clean(a||'')===Utility.clean(b||'')},Router.prototype.add=function(a){var b=this;return'Object'===a.constructor.name?b.routes.push(a):'Array'===a.constructor.name&&(b.routes=b.routes.concat(a)),b},Router.prototype.remove=function(a){for(var f,b=this,c=0,d=b.routes.length;c<d;c++)if(f=b.routes[c],a===f.path){b.routes.splice(c,1);break}return b},Router.prototype.get=function(a){var b=this,c=b.routes.length,d=null,f=0;for(a=Utility.strip(a),f;f<c;f++)if(d=b.routes[f],'string'==typeof d.path){if(d.path===a||d.path==='/'+a)return d;}else if(d.path.test(a))return d},Router.prototype.navigate=function(a,b){var c=this;b=null===b||void 0===b?PUSH:b,a='string'==typeof a?{path:a}:a;var d=c.get(a.path);c.state.title=d&&d.title?d.title:a.title,c.state.path=c.mode?c.root+Utility.clean(a.path):c.root+Utility.clean(a.path);var f={route:d,state:this.state,query:this.query,href:document.location.href,hash:Utility.getHash(this.href),search:Utility.getSearch(this.href),pathname:Utility.getPathname(this.href)};return!1===c.authorize(Request$1(f),Response$1(f))?(Render({type:'text',title:'401',text:'{"statusCode":401,"error":"Missing Authentication"}'}),c):(c.mode?(b===PUSH&&window.history.pushState(c.state,c.state.title,c.state.path),b===REPLACE&&window.history.replaceState(c.state,c.state.title,c.state.path)):(c.permitChangeEvent=!1,window.location.hash=c.state.path),d?d.handler(Request$1(f),Response$1(f)):Render({type:'text',title:'404',text:'{"statusCode":404,"error":"Not Found"}'}),c)},Router.prototype.listen=function(){var a=this;return a.isListening?a:(a.isListening=!0,window.addEventListener('DOMContentLoaded',function(){var b={title:document.title,path:document.location.href};a.navigate(b,REPLACE)},!1),window.addEventListener(a.mode?'popstate':'hashchange',function(b){if(a.permitChangeEvent){var c={};c=a.mode?b.state||{}:{path:b.newURL},a.navigate(c)}else a.permitChangeEvent=!0},!1),window.addEventListener('click',function(b){if(!(b.metaKey||b.ctrlKey||b.shiftKey)){for(var c=b.path?b.path[0]:b.target;c&&'A'!==c.nodeName;)c=c.parentNode;if(c&&'A'===c.nodeName&&!(c.hasAttribute('r-ignore')||c.hasAttribute('download')||'external'===c.getAttribute('rel'))){var d={path:c.href||'',title:c.title||''};a.base&&0!==Utility.getPathname(d.path).indexOf(a.base)||Utility.has(d.path,'mailto:')||Utility.has(d.path,'tel:')||Utility.has(d.path,'file:')||Utility.has(d.path,'ftp:')||a.isSameOrigin(d.path)&&(b.preventDefault(),a.isSamePath(d.path,a.state.path)||a.navigate(d,PUSH))}}},!1),a)};var Rutta={PUSH:PUSH,REPLACE:REPLACE,routers:{},fetch:Axa.request,redirect:function(a){window.location=a},router:function(a){if(!a.name)throw new Error('Router - name parameter required');if(this.routers[a.name])throw new Error('Router - name '+a.name+' exists');return this.routers[a.name]=new Router(a),this.routers[a.name]}};return Rutta});