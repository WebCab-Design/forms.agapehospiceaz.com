/*
	@preserve
	title: swathe
	version: 2.0.6
	license: mpl-2.0
	author: alexander elias
*/
(function(a,b){'object'==typeof exports&&'undefined'!=typeof module?module.exports=b():'function'==typeof define&&define.amd?define('Swathe',b):a.Swathe=b()})(this,function(){'use strict';function a(p,q){this.isChangeEventAdded=!1,this.controller=q,this.isChanging=!1,this.element=p,this.listeners={},this.clone}function b(){}function d(p){var q='';for(var r in p)q=0<q.length?q+'&':q,q=q+encodeURIComponent(r)+'='+encodeURIComponent(p[r]);return q}function g(p){if(this.doc=p.doc,this.name=p.name,this.view=p.view||{},this.model=p.model||{},this.modifiers=p.modifiers||{},this.sPrefix=p.prefix+'-',this.sValue=p.prefix+'-value',this.sFor=p.prefix+'-for-(.*?)="',this.sAccepts=p.prefix+'-(.*?)="',this.sRejects=p.prefix+'-controller=|'+p.rejects,this.query='['+p.prefix+'-controller='+p.name+']',this.rPath=/(\s)?\|(.*?)$/,this.rModifier=/^(.*?)\|(\s)?/,this.rFor=new RegExp(this.sFor),this.rPrefix=new RegExp(this.sPrefix),this.rAccepts=new RegExp(this.sAccepts),this.rRejects=new RegExp(this.sRejects),this.scope=p.doc.querySelector(this.query),!this.scope)throw new Error('missing attribute s-controller '+p.name)}var h={GET:2,SET:3,toCamelCase:function(p){return'Array'===p.constructor.name&&(p=p.join('-')),p.replace(/-[a-z]/g,function(q){return q[1].toUpperCase()})},toDashCase:function(p){return'Array'===p.constructor.name&&(p=p.join('')),p.replace(/[A-Z]/g,function(q){return'-'+q.toLowerCase()})},interact:function(p,q,r,s){for(var y,t=r.split('.'),u=t.length-1,w=q,x=0;x<u;x++){if(y=t[x],null===w[y]||void 0===w[y]){if(p===this.GET)return;p===this.SET&&(w[y]={})}w=w[y]}if(p===this.GET)return w[t[u]];return p===this.SET?(w[t[u]]=s,q):void 0},getByPath:function(p,q){return this.interact(this.GET,p,q)},setByPath:function(p,q,r){return this.interact(this.SET,p,q,r)},glance:function(p){for(var q,r=p.nodeName.toLowerCase(),s=0,t=p.attributes.length;s<t;s++)q=p.attributes[s],r=r+' '+q.name+'="'+q.value+'"';return r},eachElement:function(p,q,r,s,t){for(var w,x,u=0;u<p.length;u++)if(w=p[u],x=this.glance(w),q&&q.test(x))u+=w.children.length;else if(r&&r.test(x))continue;else s&&s.test(x)&&t(w,u)}};a.prototype.on=function(p){if('function'==typeof p.value){var q=this,r=p.cmds[1],s=p.opts[p.opts.length-1];q.element.removeEventListener(r,q.listeners[s],!1),q.listeners[s]=function(t){t.preventDefault(),p.value.call(q.controller.model,t)},q.element.addEventListener(r,q.listeners[s],!1)}},a.prototype.each=function(p){var q=this;q.clone||(q.clone=q.element.children[0]);var r=p.cmds.slice(1),s=q.clone.cloneNode(!0),t='';s=s.outerHTML,r=h.toCamelCase(r),r=new RegExp('="'+r,'g');for(var u=0,w=p.value.length;u<w;u++)t+=s.replace(r,'="'+p.attribute.value+'.'+u.toString());q.element.innerHTML=t,q.controller.insert(q.element.getElementsByTagName('*'))},a.prototype.value=function(p){var q=this;if(('checkbox'===q.element.type||'radio'===q.element.type)&&(p.value=q.modifiers(p.attribute.value,p.value),q.element.value=p.value,q.element.checked=p.value),!q.isChangeEventAdded){q.isChangeEventAdded=!0;var r=function(s){if(!q.isChanging){q.isChanging=!0;var t=s.target,u='checkbox'===t.type||'radio'===t.type?t.checked:t.value,w=t.getAttribute(q.controller.sValue);u=q.modifiers(w,u),w=w.replace(q.controller.rPath,''),h.setByPath(q.controller.model,w,u),q.isChanging=!1}};q.element.addEventListener('change',r),q.element.addEventListener('keyup',r)}},a.prototype.html=function(p){this.element.innerHTML=p.value,this.controller.insert(this.element.getElementsByTagName('*'))},a.prototype.css=function(p){1<p.cmds.length&&(p.value=p.cmds.slice(1).join('-')+': '+p.value+';'),this.element.style.cssText+=p.value},a.prototype.class=function(p){var q=p.cmds.slice(1).join('-');this.element.classList.toggle(q,p.value)},a.prototype.enable=function(p){this.element.disabled=!p.value},a.prototype.disable=function(p){this.element.disabled=p.value},a.prototype.show=function(p){this.element.hidden=!p.value},a.prototype.hide=function(p){this.element.hidden=p.value},a.prototype.write=function(p){this.element.readOnly=!p.value},a.prototype.read=function(p){this.element.readOnly=p.value},a.prototype.selected=function(p){this.element.selectedIndex=p.value},a.prototype.text=function(p){this.element.innerText=p.value},a.prototype.default=function(p){var q=h.toCamelCase(p.cmds);h.setByPath(this.element,q,p.value)},a.prototype.modifiers=function(p,q){if(-1===p.indexOf('|'))return q;for(var r=this,s=p.replace(r.controller.rModifier,'').split(' '),t=0,u=s.length;t<u;t++)s[t]in r.controller.modifiers&&(q=r.controller.modifiers[s[t]].call(q));return q},a.prototype.render=function(p){var q=this,r={attribute:p};r.attribute.value=r.attribute.value.trim(),r.path=r.attribute.value.replace(q.controller.rPath,''),r.command=r.attribute.name.replace(q.controller.rPrefix,''),r.opts=r.path.split('.'),r.cmds=r.command.split('-'),r.value=h.getByPath(q.controller.model,r.path),r.value=q.modifiers(r.attribute.value,r.value);null===r.value||void 0===r.value||(r.cmds[0]in q?q[r.cmds[0]](r):q.default(r))},a.prototype.eachAttribute=function(p,q){var r=this.element.attributes,s=0,t=r.length,u;for('string'==typeof p&&(p=new RegExp(p)),s;s<t;s++)u={name:r[s].name,value:r[s].value,full:r[s].name+'="'+r[s].value+'"'},p&&p.test(u.full)&&q(u,s)},b.prototype.descriptor=function(p,q,r){return{configurable:!0,enumerable:!0,get:function(){return q},set:function(s){q=s,r(p,q)}}},b.prototype.ins=function(p,q,r,s,t){('Object'===t.constructor.name||'Array'===t.constructor.name)&&(t=this.create(t,q,r+s,!0)),'Array'===p.constructor.name&&-1==s&&(s=0,p.splice(s,0,t),p=Object.defineProperty(p,s,this.descriptor(r+s,t,q)),s=p.length-1,t=p[s]),p=Object.defineProperty(p,s,this.descriptor(r+s,t,q)),q&&q(r+s,t)},b.prototype.del=function(p,q,r,s){if('Object'===p.constructor.name)delete p[s];else if('Array'===p.constructor.name){var t=p.length-1;p.splice(s,1),s=t}q&&q(r+s,void 0)},b.prototype.create=function(p,q,r,s){var t,u,w,x;for(u in r?r+='.':r='',x=p.constructor.name,t='Object'===x?{}:[],t=Object.defineProperty(t,'ins',{value:this.ins.bind(this,t,q,r)}),t=Object.defineProperty(t,'del',{value:this.del.bind(this,t,q,r)}),p)w=p[u],x=w.constructor.name,('Object'===x||'Array'===x)&&(w=this.create(w,q,r+u)),t=Object.defineProperty(t,u,this.descriptor(r+u,w,q)),s&&q&&q(r+u,w);return t};var j=function(p,q){return new b().create(p,q)},m={script:'text/javascript, application/javascript, application/x-javascript',json:'application/json, text/javascript',xml:'application/xml, text/xml',html:'text/html',text:'text/plain',urlencoded:'application/x-www-form-urlencoded'};g.prototype.insert=function(p){var q=this;h.eachElement(p,q.rRejects,null,q.rAccepts,function(r,s){var t=new a(r,q);t.eachAttribute(q.rAccepts,function(u){q.rFor.test(u.name)&&++s,q.view[u.value]?q.view[u.value].push(t):q.view[u.value]=[t],t.render(u)})})},g.prototype.render=function(p){var q=this;if(q.model=j(q.model,function(r){var s=r.split('.');1<s.length&&!isNaN(s.slice(-1))&&(r=s.slice(0,-1).join('.'));var t=q.view[r];if(t)for(var x,u=0,w=t.length;u<w;u++)x=t[u],x.eachAttribute(q.sAccepts+r,function(y){x.render(y)})}),q.insert(q.scope.getElementsByTagName('*')),p)return p.call(this)};var o={prefix:'s',doc:document,controllers:{},ajax:{mime:m,request:function(p){if(!p)throw new Error('Axa: requires options');if(!p.action)throw new Error('Axa: requires options.action');if(p.method||(p.method='GET'),p.headers||(p.headers={}),p.data)if('GET'===p.method)p.action=p.action+'?'+d(p.data),p.data=null;else{switch(p.requestType=p.requestType.toLowerCase(),p.responseType=p.responseType.toLowerCase(),p.requestType){case'script':p.contentType=m.script;break;case'json':p.contentType=m.json;break;case'xml':p.contentType=m.xm;break;case'html':p.contentType=m.html;break;case'text':p.contentType=m.text;break;default:p.contentType=m.urlencoded;}switch(p.responseType){case'script':p.accept=m.script;break;case'json':p.accept=m.json;break;case'xml':p.accept=m.xml;break;case'html':p.accept=m.html;break;case'text':p.accept=m.text;}p.contentType===m.json&&(p.data=JSON.stringify(p.data)),p.contentType===m.urlencoded&&(p.data=d(p.data))}var q=new XMLHttpRequest;if(q.open(p.method.toUpperCase(),p.action,!0,p.username,p.password),p.mimeType&&q.overrideMimeType(p.mimeType),p.withCredentials&&(q.withCredentials=p.withCredentials),p.accept&&(p.headers.Accept=p.accept),p.contentType&&(p.headers['Content-Type']=p.contentType),p.headers)for(var r in p.headers)q.setRequestHeader(r,p.headers[r]);q.onreadystatechange=function(){if(4===q.readyState)return 200<=q.status&&400>q.status?p.success(q):p.error(q)},q.send(p.data)},serialize:d}.request,rejects:'iframe|object|script',controller:function(p,q){if(!p.name)throw new Error('Controller - name parameter required');p.doc=p.doc||this.doc,p.prefix=p.prefix||this.prefix,p.rejects=p.rejects||this.rejects;var r=new g(p);return r.render(q),this.controllers[p.name]=r}};return o});